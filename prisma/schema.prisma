generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String     @id @default(uuid())
  nomeCompleto     String
  email            String     @unique
  senha            String
  membroDesde      DateTime   @default(now())
  statusConta      String     @default("Ativa")
  planoId          String
  promoOriginalPlanId String?
  promoExpiresAt    DateTime?
  telegramId       String?
  telegramUsername String?
  fotoPerfil       String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  bancas           Bankroll[]
  tipsters         Tipster[]
  plano            Plan       @relation(fields: [planoId], references: [id])
  promoCodeRedemptions PromoCodeRedemption[]

  @@map("users")
}

model Plan {
  id                   String   @id @default(uuid())
  nome                 String   @unique
  preco                Float    @default(0)
  limiteApostasDiarias Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  usuarios             User[]

  @@map("plans")
}

model Bankroll {
  id         String                 @id @default(uuid())
  usuarioId  String
  nome       String
  descricao  String?
  status     String                 @default("Ativa")
  ePadrao    Boolean                @default(false)
  criadoEm   DateTime               @default(now())
  createdAt  DateTime               @default(now())
  updatedAt  DateTime               @updatedAt
  usuario    User                   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  apostas    Bet[]
  transacoes FinancialTransaction[]

  @@map("bankrolls")
}

model FinancialTransaction {
  id            String   @id @default(uuid())
  bancaId       String
  tipo          String
  casaDeAposta  String
  valor         Float
  dataTransacao DateTime @default(now())
  observacao    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  banca         Bankroll @relation(fields: [bancaId], references: [id], onDelete: Cascade)

  @@map("financial_transactions")
}

model Bet {
  id            String   @id @default(uuid())
  bancaId       String
  esporte       String
  jogo          String
  torneio       String?
  pais          String?
  mercado       String
  tipoAposta    String
  aposta String?
  valorApostado Float
  odd           Float
  bonus         Float    @default(0)
  dataJogo      DateTime
  tipster       String?
  status        String   @default("Pendente")
  casaDeAposta  String
  retornoObtido Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  banca         Bankroll @relation(fields: [bancaId], references: [id], onDelete: Cascade)

  @@map("bets")
}

model Tipster {
  id        String   @id @default(uuid())
  usuarioId String
  nome      String
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  usuario   User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, nome])
  @@map("tipsters")
}

model PromoCodeRedemption {
  id         String   @id @default(uuid())
  code       String
  userId     String
  redeemedAt DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([code, userId])
  @@index([code])
  @@map("promo_code_redemptions")
}
